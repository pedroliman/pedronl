---
title: Factory Physics' Flow Benchmarking in R
author: Pedro N. de Lima
date: '2019-04-22'
slug: factory-physics-flow-benchmarking-in-r
categories:
  - R Blogs
  - R
tags:
  - R
  - Simulation
header:
  caption: ''
  image: ''
bibliography: [references/references-metamodeling.bib]
link-citations: true
---



<p><a href="https://factoryphysics.com/flow-benchmarking">Flow Benchmarking</a> is an absolute benchmarking technique that allows one to visualize the performance limits of a manufacturing system in terms of Work in Process, Throughput and Cycle Time. This technique has been introduced in the award-winning <em>Factory Physics</em> (FP) Book <span class="citation">(Hopp and Spearman <a href="#ref-hopp2008factory">2008</a>)</span>, and is a key component of the science-based manufacturing management approach described in <span class="citation">(Pound, Bell, and Spearman <a href="#ref-pound2014factory">2014</a>)</span>. This post will use <a href="https://www.r-project.org/">R</a> to allow one to quickly run this analysis using the Basic Factory Dynamics equations found in the original FP books.</p>
<div id="defining-fp-laws" class="section level2">
<h2>Defining FP Laws</h2>
<p>The Flow Benchmarking analysis is grounded on Little’s Law (WIP = TH * CT), and utilizes three general cases as absolute benchmarks for any real manufacturing system: The <strong>Best Case</strong>, the <strong>Worst Case</strong> and the <strong>Practical Worst Case</strong> .Please refer to <span class="citation">(Hopp and Spearman <a href="#ref-hopp2008factory">2008</a>)</span> and <span class="citation">(Pound, Bell, and Spearman <a href="#ref-pound2014factory">2014</a>)</span> for the rationale for these laws and equations.</p>
<p>I’ll define these equations as R functions:</p>
<pre class="r"><code>calc_w0 = function(rb, t0) {rb * t0}

ct_best = function(t0, w, w0, rb) {ifelse(w&lt;=w0,t0,w/rb)}

th_best = function(t0, w, w0, rb) {ifelse(w&lt;=w0,w/t0,rb)}

ct_worst = function(w,t0){w*t0}

th_worst = function(t0){1/t0}

ct_marginal = function(t0,w,rb){t0+(w-1)/rb}

th_marginal = function(w0,w,rb){rb*w/(w0+w-1)}</code></pre>
<p>In summary, these equations provide a starting point to discuss how well a manufacturing system is doing in terms of converting inventory to Throughput. The initial analysis requires two inputs. The first input is the <strong>Bottleneck rate (rb)</strong>, which is the production rate (parts, orders / time) of the bottleneck (defined as the process center with the highest long-term utilization). The second parameter is the <strong>Total Raw Processing Time (t0)</strong>, which is the sum of the long-term average process times of each processing center. Based on these two parameters, its possible to draw benchmarking curves for the System’s Throughput and Cycle Time as a function of its Work in Process, assuming a CONWIP control system <span class="citation">(SPEARMAN, WOODRUFF, and HOPP <a href="#ref-Spearman1990">1990</a>)</span>.</p>
</div>
<div id="drawing-benchmarking-curves" class="section level2">
<h2>Drawing Benchmarking Curves</h2>
<p>Once I have the basic laws of manufacturing dynamics as R functions, I’ll create a <code>benchmarck_flow</code> function to execute the analysis. This function accepts the <code>rb</code> and <code>t0</code> parameters and will calculate the system’s Throughput and Cycle time as a function of the wip under different scenarios for benchmarking purposes.</p>
<pre class="r"><code>## Defining Cycle time and Throughput functions

benchmark_flow = function(rb, t0, step = 1, wip_mult = 5) {
  
  # First, calculate wip_crit
  w0 = calc_w0(rb = rb, t0 = t0)
  
  # Then, define WIP Range to consider:
  wip = seq.int(from = 1, to = w0 * wip_mult, by = step)
  
  # Then, calculate The Best Case Variables
  Best_Cycle_Time = ct_best(t0 = t0, w = wip, w0 = w0, rb = rb)
  Best_Throughput = th_best(t0 = t0, w = wip, w0 = w0, rb = rb)
  
  best_data = data.frame(WIP = wip,
                    Throughput = Best_Throughput,
                    CycleTime = Best_Cycle_Time,
                    Scenario = &quot;Best Case&quot;)
  
  # Calculate the Marginal Cases:
  Marginal_Cycle_Time = ct_marginal(t0=t0,w=wip,rb=rb)
  Marginal_Throughput = th_marginal(w0=w0,w=wip,rb=rb)
  
  marginal_data = data.frame(WIP = wip,
                    Throughput = Marginal_Throughput,
                    CycleTime = Marginal_Cycle_Time,
                    Scenario = &quot;Marginal&quot;)
  
  # Calculate Worst Case
  worst_data = data.frame(
    WIP = wip,
    Throughput = th_worst(t0 = t0),
    CycleTime = ct_worst(w = wip, t0 = t0),
    Scenario = &quot;Worst Case&quot;
  )

  # Output A DataFrame with results:
  # I&#39;m not including the Worst Case because it&#39;s unrealistic (and messes up my cycle time plot).
  rbind(best_data, marginal_data, worst_data)
  
}

# The First Penny Fab Example:
data_benchmark = benchmark_flow(rb = 0.5, t0 = 8)

knitr::kable(head(data_benchmark))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">WIP</th>
<th align="right">Throughput</th>
<th align="right">CycleTime</th>
<th align="left">Scenario</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.125</td>
<td align="right">8</td>
<td align="left">Best Case</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.250</td>
<td align="right">8</td>
<td align="left">Best Case</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.375</td>
<td align="right">8</td>
<td align="left">Best Case</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.500</td>
<td align="right">8</td>
<td align="left">Best Case</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.500</td>
<td align="right">10</td>
<td align="left">Best Case</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.500</td>
<td align="right">12</td>
<td align="left">Best Case</td>
</tr>
</tbody>
</table>
<p>Ok, now I have a table with all the benchmarking results, let’s plot it!</p>
<pre class="r"><code>library(tidyr)
library(ggplot2)
library(viridis)</code></pre>
<pre><code>## Carregando pacotes exigidos: viridisLite</code></pre>
<pre class="r"><code># Lets define a wrapper function for our plot:

plot_benchmarking = function(data) {
  data %&gt;%
    gather(-WIP, -Scenario, key = &quot;var&quot;, value = &quot;Value&quot;) %&gt;%
  ggplot(aes(x = WIP, y = Value, color = Scenario)) +
    geom_line(size = 1) +
    facet_wrap(~ var, scales = &quot;free&quot;, nrow = 2, ncol = 1) +
    labs(title = &quot;Flow Benchmarking Plot&quot;) +
    scale_color_viridis(discrete = TRUE, option = &quot;D&quot;) + 
    theme_bw()
}

# Then let&#39;s just benchmark and plot!

plot_benchmarking(data = benchmark_flow(rb = 0.5, t0 = 8, wip_mult = 5))</code></pre>
<p><img src="/post/2019-04-22-factory-physics-flow-benchmarking-with-arena-and-r_files/figure-html/factory-physics-flow-benchmarking-cycletime-wip-throughput-plot-1.png" width="672" /></p>
<p>After plotting the benchmarking curves, compare the curves with the system’s actual condition (mark an “x” indicating the system’s actual WIP, Cycle Time and Throughput), and have a productive discussion about how to improve it. Again, I suggest you to read the <span class="citation">(Pound, Bell, and Spearman <a href="#ref-pound2014factory">2014</a>)</span> book to understand the many uses of this plot.</p>
<p>If you would like to perform a more detailed analysis of a complex system, it’s possible to use a Simulation Model of the actual system, and plot the results from Simulation Runs (you would see a another line on these plots). Doing this would allow you to gain predictive insight of where the system <strong>will be</strong> if you add WIP or make improvements.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-hopp2008factory">
<p>Hopp, W.J., and M.L. Spearman. 2008. <em>Factory Physics</em>. Irwin/Mcgraw-Hill Series in Operations and Decision Sciences. McGraw-Hill. <a href="https://books.google.com.br/books?id=tEjkAAAACAAJ">https://books.google.com.br/books?id=tEjkAAAACAAJ</a>.</p>
</div>
<div id="ref-pound2014factory">
<p>Pound, E.S., J.H. Bell, and M.L. Spearman. 2014. <em>Factory Physics for Managers: How Leaders Improve Performance in a Post-Lean Six Sigma World</em>. McGraw-Hill Education. <a href="https://books.google.com.br/books?id=B5sXAwAAQBAJ">https://books.google.com.br/books?id=B5sXAwAAQBAJ</a>.</p>
</div>
<div id="ref-Spearman1990">
<p>SPEARMAN, MARK L., DAVID L. WOODRUFF, and WALLACE J. HOPP. 1990. “CONWIP: A Pull Alternative to Kanban.” <em>International Journal of Production Research</em> 28 (5). Taylor &amp; Francis: 879–94. <a href="https://doi.org/10.1080/00207549008942761">https://doi.org/10.1080/00207549008942761</a>.</p>
</div>
</div>
</div>
